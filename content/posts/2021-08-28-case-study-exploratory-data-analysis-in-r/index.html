---
title: 'Case Study: Exploratory Data Analysis in R'
author: ''
date: '2021-08-28'
slug: []
categories: []
tags:
  - data_visualization
  - data_wrangling
---

<script src="{{< blogdown/postref >}}index_files/header-attrs/header-attrs.js"></script>


<pre class="r"><code>library(tidyverse)</code></pre>
<pre><code>## -- Attaching packages --------------------------------------- tidyverse 1.3.1 --</code></pre>
<pre><code>## v ggplot2 3.3.3     v purrr   0.3.4
## v tibble  3.1.2     v dplyr   1.0.6
## v tidyr   1.1.3     v stringr 1.4.0
## v readr   1.4.0     v forcats 0.5.1</code></pre>
<pre><code>## -- Conflicts ------------------------------------------ tidyverse_conflicts() --
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()</code></pre>
<pre class="r"><code>votes &lt;- read.csv(&quot;votes.csv&quot;)</code></pre>
<div id="filtering-rows" class="section level2">
<h2>1-2 Filtering rows</h2>
<p>The vote column in the dataset has a number that represents that country’s vote:</p>
<p>1 = Yes
2 = Abstain
3 = No
8 = Not present
9 = Not a member
One step of data cleaning is removing observations (rows) that you’re not interested in. In this case, you want to remove “Not present” and “Not a member”.</p>
<pre class="r"><code># Filter for votes that are &quot;yes&quot;, &quot;abstain&quot;, or &quot;no&quot;
votes %&gt;% filter(vote&lt;=3)</code></pre>
</div>
<div id="adding-a-year-column" class="section level2">
<h2>1-3 Adding a year column</h2>
<p>The next step of data cleaning is manipulating your variables (columns) to make them more informative.</p>
<p>In this case, you have a session column that is hard to interpret intuitively. But since the UN started voting in 1946, and holds one session per year, you can get the year of a UN resolution by adding 1945 to the session number.</p>
<pre class="r"><code># Add another %&gt;% step to add a year column
votes %&gt;%
  filter(vote &lt;= 3) %&gt;%
mutate(year=session+1945)</code></pre>
</div>
<div id="adding-a-country-column" class="section level2">
<h2>1-4 Adding a country column</h2>
<p>The country codes in the ccode column are what’s called Correlates of War codes. This isn’t ideal for an analysis, since you’d like to work with recognizable country names.</p>
<p>You can use the countrycode package to translate. For example:</p>
<p>library(countrycode)</p>
</div>
<div id="translate-the-country-code-2" class="section level1">
<h1>Translate the country code 2</h1>
<blockquote>
<p>countrycode(2, “cown”, “country.name”)
[1] “United States”</p>
</blockquote>
</div>
<div id="translate-multiple-country-codes" class="section level1">
<h1>Translate multiple country codes</h1>
<blockquote>
<p>countrycode(c(2, 20, 40), “cown”, “country.name”)
[1] “United States” “Canada” “Cuba”</p>
</blockquote>
<pre class="r"><code># Load the countrycode package
library(countrycode)

# Convert country code 100
countrycode(100, &quot;cown&quot;, &quot;country.name&quot;)</code></pre>
<pre><code>## [1] &quot;Colombia&quot;</code></pre>
<pre class="r"><code># Add a country column within the mutate: votes_processed
votes_processed &lt;- votes %&gt;%
  filter(vote &lt;= 3) %&gt;%
  mutate(year = session + 1945,
         country = countrycode(ccode, &quot;cown&quot;, &quot;country.name&quot;))</code></pre>
<div id="summarizing-the-full-dataset" class="section level2">
<h2>1-6 Summarizing the full dataset</h2>
<p>In this analysis, you’re going to focus on “% of votes that are yes” as a metric for the “agreeableness” of countries.</p>
<p>You’ll start by finding this summary for the entire dataset: the fraction of all votes in their history that were “yes”. Note that within your call to summarize(), you can use n() to find the total number of votes and mean(vote == 1) to find the fraction of “yes” votes.</p>
<pre class="r"><code># Print votes_processed
print(votes_processed)

# Find total and fraction of &quot;yes&quot; votes
votes_processed %&gt;%
  summarize(total = n(),
            percent_yes = mean(vote == 1))</code></pre>
</div>
<div id="summarizing-by-year" class="section level2">
<h2>1-7 Summarizing by year</h2>
<p>The summarize() function is especially useful because it can be used within groups.</p>
<p>For example, you might like to know how much the average “agreeableness” of countries changed from year to year. To examine this, you can use group_by() to perform your summary not for the entire dataset, but within each year.</p>
<pre class="r"><code># Change this code to summarize by year
votes_processed %&gt;%
group_by(year) %&gt;%
  summarize(total = n(),
            percent_yes = mean(vote == 1))</code></pre>
</div>
<div id="summarizing-by-country" class="section level2">
<h2>1-8 Summarizing by country</h2>
<p>In the last exercise, you performed a summary of the votes within each year. You could instead summarize() within each country, which would let you compare voting patterns between countries.</p>
<pre class="r"><code># Summarize by country: by_country
by_country &lt;- votes_processed %&gt;%
  group_by(country) %&gt;%
  summarize(total = n(),
            percent_yes = mean(vote == 1))</code></pre>
</div>
<div id="sorting-by-percentage-of-yes-votes" class="section level2">
<h2>1-10 Sorting by percentage of “yes” votes</h2>
<p>Now that you’ve summarized the dataset by country, you can start examining it and answering interesting questions.</p>
<p>For example, you might be especially interested in the countries that voted “yes” least often, or the ones that voted “yes” most often.</p>
<pre class="r"><code># You have the votes summarized by country
by_country &lt;- votes_processed %&gt;%
  group_by(country) %&gt;%
  summarize(total = n(),
            percent_yes = mean(vote == 1))

# Print the by_country dataset
print(by_country)</code></pre>
<pre><code>## # A tibble: 200 x 3
##    country           total percent_yes
##    &lt;chr&gt;             &lt;int&gt;       &lt;dbl&gt;
##  1 Afghanistan        2373       0.859
##  2 Albania            1695       0.717
##  3 Algeria            2213       0.899
##  4 Andorra             719       0.638
##  5 Angola             1431       0.924
##  6 Antigua &amp; Barbuda  1302       0.912
##  7 Argentina          2553       0.768
##  8 Armenia             758       0.747
##  9 Australia          2575       0.557
## 10 Austria            2389       0.622
## # ... with 190 more rows</code></pre>
<pre class="r"><code># Sort in ascending order of percent_yes
by_country %&gt;% arrange(percent_yes)</code></pre>
<pre><code>## # A tibble: 200 x 3
##    country                          total percent_yes
##    &lt;chr&gt;                            &lt;int&gt;       &lt;dbl&gt;
##  1 Zanzibar                             2       0    
##  2 United States                     2568       0.269
##  3 Palau                              369       0.339
##  4 Israel                            2380       0.341
##  5 &lt;NA&gt;                              1075       0.397
##  6 United Kingdom                    2558       0.417
##  7 France                            2527       0.427
##  8 Micronesia (Federated States of)   724       0.442
##  9 Marshall Islands                   757       0.491
## 10 Belgium                           2568       0.492
## # ... with 190 more rows</code></pre>
<pre class="r"><code># Now sort in descending order
by_country %&gt;% arrange(desc(percent_yes))</code></pre>
<pre><code>## # A tibble: 200 x 3
##    country              total percent_yes
##    &lt;chr&gt;                &lt;int&gt;       &lt;dbl&gt;
##  1 São Tomé &amp; Príncipe   1091       0.976
##  2 Seychelles             881       0.975
##  3 Djibouti              1598       0.961
##  4 Guinea-Bissau         1538       0.960
##  5 Timor-Leste            326       0.957
##  6 Mauritius             1831       0.950
##  7 Zimbabwe              1361       0.949
##  8 Comoros               1133       0.947
##  9 United Arab Emirates  1934       0.947
## 10 Mozambique            1701       0.947
## # ... with 190 more rows</code></pre>
</div>
<div id="filtering-summarized-output" class="section level2">
<h2>1-11 Filtering summarized output</h2>
<p>In the last exercise, you may have noticed that the country that voted least frequently, Zanzibar, had only 2 votes in the entire dataset. You certainly can’t make any substantial conclusions based on that data!</p>
<p>Typically in a progressive analysis, when you find that a few of your observations have very little data while others have plenty, you set some threshold to filter them out.</p>
<pre class="r"><code># Filter out countries with fewer than 100 votes
by_country %&gt;%
  arrange(percent_yes) %&gt;%
  filter(total&gt;100)</code></pre>
<pre><code>## # A tibble: 197 x 3
##    country                          total percent_yes
##    &lt;chr&gt;                            &lt;int&gt;       &lt;dbl&gt;
##  1 United States                     2568       0.269
##  2 Palau                              369       0.339
##  3 Israel                            2380       0.341
##  4 &lt;NA&gt;                              1075       0.397
##  5 United Kingdom                    2558       0.417
##  6 France                            2527       0.427
##  7 Micronesia (Federated States of)   724       0.442
##  8 Marshall Islands                   757       0.491
##  9 Belgium                           2568       0.492
## 10 Canada                            2576       0.508
## # ... with 187 more rows</code></pre>
</div>
</div>
