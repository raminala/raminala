---
title: Dealing With Missing Data in R
author: ''
date: '2021-09-06'
slug: []
categories: []
tags:
  - data_wrangling
---

<script src="{{< blogdown/postref >}}index_files/header-attrs/header-attrs.js"></script>


<pre class="r"><code>library(naniar)
library(tidyverse)</code></pre>
<pre><code>## -- Attaching packages --------------------------------------- tidyverse 1.3.1 --</code></pre>
<pre><code>## v ggplot2 3.3.3     v purrr   0.3.4
## v tibble  3.1.1     v dplyr   1.0.6
## v tidyr   1.1.3     v stringr 1.4.0
## v readr   1.4.0     v forcats 0.5.1</code></pre>
<pre><code>## -- Conflicts ------------------------------------------ tidyverse_conflicts() --
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()</code></pre>
<pre class="r"><code>dat_hw &lt;- read.csv(&quot;dat_hw.csv&quot;)
airquality &lt;- read.csv(&quot;airquality.csv&quot;)</code></pre>
<div id="using-and-finding-missing-values" class="section level2">
<h2>1-2 Using and finding missing values</h2>
<p>When working with missing data, there are a couple of commands that you should be familiar with - firstly, you should be able to identify if there are any missing values, and where these are.</p>
<p>Using the any_na() and are_na() tools, identify which values are missing.</p>
<pre class="r"><code># Create x, a vector, with values NA, NaN, Inf, &quot;.&quot;, and &quot;missing&quot;
x &lt;- c(NA, NaN, Inf, &quot;.&quot;, &quot;missing&quot;)

# Use any_na() and are_na() on to explore the missings
any_na(x)</code></pre>
<pre><code>## [1] TRUE</code></pre>
<pre class="r"><code>are_na(x)</code></pre>
<pre><code>## [1]  TRUE FALSE FALSE FALSE FALSE</code></pre>
</div>
<div id="how-many-missing-values-are-there" class="section level2">
<h2>1-3 How many missing values are there?</h2>
<p>One of the first things that you will want to check with a new dataset is if there are any missing missing values, and how many there are.</p>
<p>You could use are_na() to and count up the missing values, but the most efficient way to count missings is to use the n_miss() function. This will tell you the total number of missing values in the data.</p>
<p>You can then find the percent of missing values in the data with the pct_miss function. This will tell you the percentage of missing values in the data.</p>
<p>You can also find the complement to these - how many complete values there are - using n_complete and pct_complete.</p>
<pre class="r"><code># Use n_miss() to count the total number of missing values in dat_hw
n_miss(dat_hw)</code></pre>
<pre><code>## [1] 30</code></pre>
<pre class="r"><code># Use n_miss() on dat_hw$weight to count the total number of missing values
n_miss(dat_hw$weight)</code></pre>
<pre><code>## [1] 15</code></pre>
<pre class="r"><code># Use n_complete() on dat_hw to count the total number of complete values
n_complete(dat_hw)</code></pre>
<pre><code>## [1] 170</code></pre>
<pre class="r"><code># Use n_complete() on dat_hw$weight to count the total number of complete values
n_complete(dat_hw$weight)</code></pre>
<pre><code>## [1] 85</code></pre>
<pre class="r"><code># Use prop_miss() and prop_complete() on dat_hw to count the total number of missing values in each of the variables
prop_miss(dat_hw)</code></pre>
<pre><code>## [1] 0.15</code></pre>
<pre class="r"><code>prop_complete(dat_hw)</code></pre>
<pre><code>## [1] 0.85</code></pre>
</div>
<div id="summarizing-missingness" class="section level2">
<h2>1-6 Summarizing missingness</h2>
<p>Now that you understand the behavior of missing values in R, and how to count them, let’s scale up our summaries for cases (rows) and variables, using miss_var_summary() and miss_case_summary(), and also explore how they can be applied for groups in a dataframe, using the group_by function from dplyr.</p>
<pre class="r"><code># Summarize missingness in each variable of the `airquality` dataset
miss_var_summary(airquality)</code></pre>
<pre><code>## # A tibble: 6 x 3
##   variable n_miss pct_miss
##   &lt;chr&gt;     &lt;int&gt;    &lt;dbl&gt;
## 1 Ozone        37    24.2 
## 2 Solar.R       7     4.58
## 3 Wind          0     0   
## 4 Temp          0     0   
## 5 Month         0     0   
## 6 Day           0     0</code></pre>
<pre class="r"><code># Summarize missingness in each case of the `airquality` dataset
miss_case_summary(airquality)</code></pre>
<pre><code>## # A tibble: 153 x 3
##     case n_miss pct_miss
##    &lt;int&gt;  &lt;int&gt;    &lt;dbl&gt;
##  1     5      2     33.3
##  2    27      2     33.3
##  3     6      1     16.7
##  4    10      1     16.7
##  5    11      1     16.7
##  6    25      1     16.7
##  7    26      1     16.7
##  8    32      1     16.7
##  9    33      1     16.7
## 10    34      1     16.7
## # ... with 143 more rows</code></pre>
<pre class="r"><code># Return the summary of missingness in each variable, 
# grouped by Month, in the `airquality` dataset
airquality %&gt;% group_by(Month) %&gt;% miss_var_summary()</code></pre>
<pre><code>## # A tibble: 25 x 4
## # Groups:   Month [5]
##    Month variable n_miss pct_miss
##    &lt;int&gt; &lt;chr&gt;     &lt;int&gt;    &lt;dbl&gt;
##  1     5 Ozone         5     16.1
##  2     5 Solar.R       4     12.9
##  3     5 Wind          0      0  
##  4     5 Temp          0      0  
##  5     5 Day           0      0  
##  6     6 Ozone        21     70  
##  7     6 Solar.R       0      0  
##  8     6 Wind          0      0  
##  9     6 Temp          0      0  
## 10     6 Day           0      0  
## # ... with 15 more rows</code></pre>
<pre class="r"><code># Return the summary of missingness in each case, 
# grouped by Month, in the `airquality` dataset
airquality %&gt;% group_by(Month) %&gt;% miss_case_summary()</code></pre>
<pre><code>## # A tibble: 153 x 4
## # Groups:   Month [5]
##    Month  case n_miss pct_miss
##    &lt;int&gt; &lt;int&gt;  &lt;int&gt;    &lt;dbl&gt;
##  1     5     5      2       40
##  2     5    27      2       40
##  3     5     6      1       20
##  4     5    10      1       20
##  5     5    11      1       20
##  6     5    25      1       20
##  7     5    26      1       20
##  8     5     1      0        0
##  9     5     2      0        0
## 10     5     3      0        0
## # ... with 143 more rows</code></pre>
</div>
<div id="tabulating-missingness" class="section level2">
<h2>1-7 Tabulating Missingness</h2>
<p>The summaries of missingness we just calculated give us the number and percentage of missing observations for the cases and variables.</p>
<p>Another way to summarize missingness is by tabulating the number of times that there are 0, 1, 2, 3, missings in a variable, or in a case.</p>
<p>In this exercise we are going to tabulate the number of missings in each case and variable using miss_var_table() and miss_case_table(), and also combine these summaries with the the group_by operator from dplyr. to explore the summaries over a grouping variable in the dataset.</p>
<pre class="r"><code># Tabulate missingness in each variable and case of the `airquality` dataset
miss_var_table(airquality)</code></pre>
<pre><code>## # A tibble: 3 x 3
##   n_miss_in_var n_vars pct_vars
##           &lt;int&gt;  &lt;int&gt;    &lt;dbl&gt;
## 1             0      4     66.7
## 2             7      1     16.7
## 3            37      1     16.7</code></pre>
<pre class="r"><code>miss_case_table(airquality)</code></pre>
<pre><code>## # A tibble: 3 x 3
##   n_miss_in_case n_cases pct_cases
##            &lt;int&gt;   &lt;int&gt;     &lt;dbl&gt;
## 1              0     111     72.5 
## 2              1      40     26.1 
## 3              2       2      1.31</code></pre>
<pre class="r"><code># Tabulate the missingness in each variable, grouped by Month, in the `airquality` dataset
airquality %&gt;% group_by(Month) %&gt;% miss_var_table()</code></pre>
<pre><code>## # A tibble: 12 x 4
## # Groups:   Month [5]
##    Month n_miss_in_var n_vars pct_vars
##    &lt;int&gt;         &lt;int&gt;  &lt;int&gt;    &lt;dbl&gt;
##  1     5             0      3       60
##  2     5             4      1       20
##  3     5             5      1       20
##  4     6             0      4       80
##  5     6            21      1       20
##  6     7             0      4       80
##  7     7             5      1       20
##  8     8             0      3       60
##  9     8             3      1       20
## 10     8             5      1       20
## 11     9             0      4       80
## 12     9             1      1       20</code></pre>
<pre class="r"><code># Tabulate of missingness in each case, grouped by Month, in the `airquality` dataset
airquality %&gt;% group_by(Month) %&gt;% miss_case_table()</code></pre>
<pre><code>## # A tibble: 11 x 4
## # Groups:   Month [5]
##    Month n_miss_in_case n_cases pct_cases
##    &lt;int&gt;          &lt;int&gt;   &lt;int&gt;     &lt;dbl&gt;
##  1     5              0      24     77.4 
##  2     5              1       5     16.1 
##  3     5              2       2      6.45
##  4     6              0       9     30   
##  5     6              1      21     70   
##  6     7              0      26     83.9 
##  7     7              1       5     16.1 
##  8     8              0      23     74.2 
##  9     8              1       8     25.8 
## 10     9              0      29     96.7 
## 11     9              1       1      3.33</code></pre>
</div>
<div id="other-summaries-of-missingness" class="section level2">
<h2>1-8 Other summaries of missingness</h2>
<p>Some summaries of missingness are particularly useful for different types of data. For example, miss_var_span() and miss_var_run().</p>
<p>miss_var_span() calculates the number of missing values in a specified variable for a repeating span. This is really useful in time series data, to look for weekly (7 day) patterns of missingness.</p>
<p>miss_var_run() calculates the number of “runs” or “streaks” of missingness. This is useful to find unusual patterns of missingness, for example, you might find a repeating pattern of 5 complete and 5 missings.</p>
<p>Both miss_var_span() and miss_var_run() work with the group_by operator from dplyr.</p>
<pre class="r"><code># Calculate the summaries for each run of missingness for the variable, hourly_counts
miss_var_run(pedestrian, var = hourly_counts)</code></pre>
<pre><code>## # A tibble: 35 x 2
##    run_length is_na   
##         &lt;int&gt; &lt;chr&gt;   
##  1       6628 complete
##  2          1 missing 
##  3       5250 complete
##  4        624 missing 
##  5       3652 complete
##  6          1 missing 
##  7       1290 complete
##  8        744 missing 
##  9       7420 complete
## 10          1 missing 
## # ... with 25 more rows</code></pre>
<pre class="r"><code># Calculate the summaries for each span of missingness, 
# for a span of 4000, for the variable hourly_counts
miss_var_span(pedestrian, var = hourly_counts, span_every = 4000)</code></pre>
<pre><code>## # A tibble: 10 x 6
##    span_counter n_miss n_complete prop_miss prop_complete n_in_span
##           &lt;int&gt;  &lt;int&gt;      &lt;int&gt;     &lt;dbl&gt;         &lt;dbl&gt;     &lt;int&gt;
##  1            1      0       4000   0               1          4000
##  2            2      1       3999   0.00025         1.00       4000
##  3            3    121       3879   0.0302          0.970      4000
##  4            4    503       3497   0.126           0.874      4000
##  5            5    745       3255   0.186           0.814      4000
##  6            6      0       4000   0               1          4000
##  7            7      1       3999   0.00025         1.00       4000
##  8            8      0       4000   0               1          4000
##  9            9    745       3255   0.186           0.814      4000
## 10           10    432       1268   0.254           0.746      1700</code></pre>
<pre class="r"><code># For each `month` variable, calculate the run of missingness for hourly_counts
pedestrian %&gt;% group_by(month) %&gt;% miss_var_run(var = hourly_counts)</code></pre>
<pre><code>## # A tibble: 51 x 3
## # Groups:   month [12]
##    month    run_length is_na   
##    &lt;ord&gt;         &lt;int&gt; &lt;chr&gt;   
##  1 January        2976 complete
##  2 February       2784 complete
##  3 March          2976 complete
##  4 April           888 complete
##  5 April           552 missing 
##  6 April          1440 complete
##  7 May             744 complete
##  8 May              72 missing 
##  9 May            2160 complete
## 10 June           2880 complete
## # ... with 41 more rows</code></pre>
<pre class="r"><code># For each `month` variable, calculate the span of missingness 
# of a span of 2000, for the variable hourly_counts
pedestrian %&gt;% group_by(month) %&gt;% miss_var_span(var = hourly_counts, span_every = 2000)</code></pre>
<pre><code>## # A tibble: 25 x 7
## # Groups:   month [12]
##    month    span_counter n_miss n_complete prop_miss prop_complete n_in_span
##    &lt;ord&gt;           &lt;int&gt;  &lt;int&gt;      &lt;int&gt;     &lt;dbl&gt;         &lt;dbl&gt;     &lt;int&gt;
##  1 January             1      0       2000     0             1          2000
##  2 January             2      0        976     0             1           976
##  3 February            1      0       2000     0             1          2000
##  4 February            2      0        784     0             1           784
##  5 March               1      0       2000     0             1          2000
##  6 March               2      0        976     0             1           976
##  7 April               1    552       1448     0.276         0.724      2000
##  8 April               2      0        880     0             1           880
##  9 May                 1     72       1928     0.036         0.964      2000
## 10 May                 2      0        976     0             1           976
## # ... with 15 more rows</code></pre>
</div>
<div id="section" class="section level2">
<h2>1-10</h2>
</div>
<div id="section-1" class="section level2">
<h2>1-11</h2>
</div>
<div id="section-2" class="section level2">
<h2>1-12</h2>
</div>
